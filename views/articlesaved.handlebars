<nav class='navbar navbar-default'>
    <div class='container-fluid'>
        <div class='navbar-header'>
            <button type='button' class='navbar-toggle collapsed' data-toggle='collapse'
                data-target='#bs-exemple-navbar-collapse-1' aria-expanded='false'>
                <span class='sr-only'>Toggle navigation</span>
                <span class='icon-bar'></span>
                <span class='icon-bar'></span>
                <span class='icon-bar'></span>
            </button>
            <a class='navbar-brand' href='#'> NYT Scrapper</a>
        </div>
        <div class='collapse navbar-collapse' id='bs-exemple-navbar-collapse-1'>
            <ul class='nav navbar-nav'>
                <li><a href='/'> Home</a></li>
                <li class='active'><a href='/articlesaved'> Saved Articles<span class='sr-only'> (current)</span></a>
                </li>
            </ul>
            <form action='/scrape' method='POST' class='navbar-form navbar-left'>
                <button type='submit' class='btn btn-info'> Scrape New Articles</button>
            </form>
        </div>
    </div>
</nav>
<!--end of navigation-->
<!--main container-->
<div class='container'>
    <div class='row'>
        <div class='col-md-12'>
            <div class='jumbotron'>
                <div class='pictureText'> The New York Times Scraper</div>
            </div>
        </div>
    </div>
    <div class='row'>
        <div class='col-md-12'>
            {{#each articles}}
            <div class='panel panel-default'>
                <div class='panel-heading row'>
                    <div class='col-s-6'>
                        <h3 class='panel-title pull-left'>{{this.title}}</h3>
                    </div>
                    <div class='col -s-3'>
                        <button id='modalbutton' type='submit' class='btn btn-default pull-right' data-toggle='modal'
                            data-id={{this.id}} data-target='#myModal'> Article Notes</button>
                    </div>
                    <div class='col-s-6'>
                        <form action='/delete/{{this.id}}?_method=DELETE' method='POST'>
                            <button type='submit' class='btn btn-default pull-right'> Delete from Saved</button>
                        </form>
                    </div>
                </div>
                <div class='row'>
                    <div class='col-md-12'>
                        <div class='panel-body'>
                            <p>{{this.link</p>
                        </div>
                    </div>
                </div>
            </div>
            {{/each}}
                        </div>
                    </div>
                </div>
                <!--modal-->
                <div class='modal fade' id='myModal' tabindex='-1' role='dialog' aria-labelledby='myModalLabel'>
                    <div class='modal-dialog' role='document'>
                        <dic class='modal-content'>
                            <div class='modal-header'>
                                <button type='button' class='close' data-dismiss='modal' aria-label='close'><span
                                        aria-hidden='true'>&times;</span></button>
                                <h4 class='modal-title' id='myModalLabel'> Notes For Articles<span
                                        id='articleID'></span></h4>
                            </div>
                            <div class='modal-body'>
                                <div id='notes'></div>
                            </div>
                        </dic>
                    </div>
                </div>
                <script src='https://code.jquery.com/jquery-3.1.1.min.js'></script>

                <script>
                    $(document).on('click', '#modalbutton', function () {
                        // Empty the notes from the note section
                        $('#notes').empty();
                        // Save the id from the button tag
                        let thisId = $(this).attr('data-id');
                        $('#articleID').text(thisId);
                        //ajax call for the Article
                        $.ajax({
                            method: 'GET',
                            url: '/articles/' + thisId
                        })
                            // With that done, add the note information to the page
                            .done(function (data) {
                                console.log(data);
                                // Placeholder for notes
                                $('#notes').append('<p id="actualnotes"></p>');
                                if (data.notes) {
                                    $('#actualnotes').append('<ul id="notelist">'');
                                    for (let i = 0; i < data.notes.length; i++) {
                                        $('#notelist').append("<li id='" + data.notes[i]._id + "'>" + data.notes[i].body + " " +
                                            "<button data-id='" + data.notes[i]._id +
                                            "' id='deletenote'>X</button></li>");
                                    }
                                    $('#actualnotes').append('</ul>');
                                } else {
                                    $('#actualnotes').text("There aren't any notes yet.");
                                }
                                // A textarea to add a new note body
                                $('#notes').append("<textarea id='bodyinput' name='body'></textarea>");
                                $('#notes').append("<button data-id='" + data._id + "' id='savenote'>Save Note</button>");
                            });
                    });
                    $(document).on('click', '#savenote', function () {
                        // Grab the id associated with the article from the submit button
                        let thisId = $(this).attr('data-id');
                        // Run a POST request to change the note, using what's entered in the inputs
                        $.ajax({
                            method: 'POST',
                            url: '/articles/' + thisId,
                            data: {
                                body: $('#bodyinput').val()
                            }

                        })
                            .done(function (data) {
                                $('#notelist').empty();
                                for (let i = 0; i < data.notes.length; i++) {
                                    $('#notelist').append("<li id='" + data.notes[i]._id + "'>" + data.notes[i].body + " " + "<button data-id='" + data.notes[i]._id + "' id='deletenote'>X</button></li>");
                                }
                            });
                        //remove the values entered in the input and textarea for note entry
                        $('#bodyinput').val('');
                    });
                    // When you click the deletenote button
                    $(document).on('click', '#deletenote', function () {
                        // Grab the id associated with the note
                        let thisId = $(this).attr('data-id');
                        // Run a POST request to delete the note
                        $.ajax({
                            method: 'GET',
                            url: '/notes/' + thisId,
                        })
                            .done(function (data) {
                                $('#' + data._id).remove();
                            });
                    });
                </script>